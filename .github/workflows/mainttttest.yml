  name: CI/CD
	
  on:
    push:
      branches: [ release, main ]
    pull_request:
      branches: [ release, main]
	
  jobs:
    build:
      runs-on: ubuntu-latest
	
      steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-java@v2
        with: 
          distribution: 'build'
          java-version: '17'
        
      - name: Grant execute
        run: chmod +x gradlew
	
      - name: Build
        run: |
          echo Build.
          ./gradlew clean build
          npm start

      - name: Set artifact
        run: echo "artifact=$ (ls ./build/libs)" >> $GITHUB_ENV

      - name: Deploy to Lightsail
        uses: orderabbit/store24H-front@main
        with:
          host: ${{ secrets.LIGHTSAIL_HOST }}
          username: ${{ secrets.LIGHTSAIL_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /home/ubuntu/store24H-front
            # 다음에 artifact 사용 가능
            echo $artifact
            # 여기에 배포 스크립트를 작성하고 실행합니다.
